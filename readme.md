### Context

> At first glance, this project might seem like just a simple “Hello World” serverless function. But, the true value lies in its design philosophy. I used to work with popular frameworks like the [Serverless Framework with Golang][serverless_framework], but eventually, I found it to be fairly complex. In response, I developed this skeleton project to provide a more intuitive and streamlined approach to building serverless applications with Go.

# Go Serverless Lambda Skeleton Project

This repository provides a **template** for deploying Go-based AWS Lambda functions using the AWS Serverless Application Model (SAM). The project is designed to be easy to use and customizable for different serverless applications.

## Features
- Automatic creation of the `bootstrap` file for custom runtimes.
- Flexible `Makefile` for building, packaging, deploying, testing, and cleaning up resources.
- Example Lambda function with a customizable event handler.

## Prerequisites
- **[AWS account][aws_account]**
- **[Go][golang]** (version 1.x or later)
- **[AWS CLI][aws_cli]** (configured with your AWS credentials and default region)
- **[AWS SAM CLI][aws_sam]**
- **GNU Make**

## Getting Started

1. **Clone the Repository:**
   ```bash
   git clone https://github.com/kwtki/go-serverless-lambda.git
   cd go-serverless-lambda
   go mod tidy
   ```

2. **Build and Deploy:**
   ```bash
   make build
   make deploy
   ```

   ✅ Use the `Tab` key to explore available commands in this project.

   ![alt text][see_commands]

3. **Test the Lambda Function Manually:**

   Go to the Lambda function's test tab in the AWS Management Console.

   Modify the Event JSON as follows:

   ```json
   {
       "name": "john doe"
   }
   ```

   Run the test and observe the output to ensure it is working as expected.

4. **Test with SAM Locally:**

   You can test your Lambda function locally using the SAM CLI with the following command:

   ```bash
   sam local invoke "HelloNameFunction" -e __test__/hello.json
   ```

   This command will invoke the `HelloNameFunction` locally using the event data from `__test__/hello.json`.

5. **Run Unit Tests:**
   ```bash
   make test
   ```

   This command will run all tests within the [`functions`](/functions/) directory. It automatically executes the tests for all Go files ending in `_test.go`.

6. **Clean Up:**

   Use the delete-related commands as explained **[here][delete_commands]**

   ```bash
   make delete-all
   ```

   This command will remove the CloudFormation stack, delete the associated S3 bucket, and clean up any IAM roles created during the deployment process.

7. **Delete the CloudFormation Stack Only:**
   ```bash
   make delete-stack
   ```

   If you only want to delete the CloudFormation stack without removing the S3 bucket or IAM roles, use this command.

## Handling Environment Variables
If your Lambda function relies on environment variables, you typically define them in a `.env` file within each function's directory. However, **pushing a `.env` file to your serverless function can expose sensitive information**.

### **Recommendation:**
For enhanced security, use **AWS Secrets Manager** or **AWS Systems Manager Parameter Store** to manage your sensitive environment variables. These services allow you to securely store and access your secrets and configuration data, which can then be retrieved by your Lambda function at runtime.

## Understanding Binary Size
The compiled Go binaries for each function (`main` files) are approximately 5MB in size. While this might seem large, it is typical for Go applications and provides several long-term benefits:

- **Performance:** Go binaries are statically linked, which means they include all dependencies. This results in faster startup times for your Lambda functions, which is critical for serverless applications.
- **Scalability:** The small size of the Go runtime and the efficiency of Go code make these binaries scalable for high-performance applications.
- **Maintainability:** As your application grows, Go’s strong typing and compile-time checks help prevent bugs and make the codebase easier to maintain.

## Project Structure
```plaintext
.
├── .gitignore
├── Makefile
├── functions/
│   ├── hello/
│   │   ├── main.go
│   │   ├── main  # Auto-generated by the Makefile (Compiled Go binary)
│   │   ├── bootstrap  # Auto-generated by the Makefile
│   │   └── .env # Environment file
│   ├── hello2/
│   │   ├── main.go
│   │   ├── main  # Auto-generated by the Makefile
│   │   ├── bootstrap  # Auto-generated by the Makefile
│   │   └── .env # Environment file
│   └── your_function_name/
│       └── main.go # Add your custom Go code here
├── go.mod
├── go.sum
└── template.yaml
```

## License
This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

### Key Points:

- **Automatic Bootstrap Creation:** The `Makefile` handles the creation of the `bootstrap` file needed for custom runtimes, so users don't need to do this manually.
- **Streamlined Clean Up:** The `delete-all` command is simplified to delete the stack and the S3 bucket, excluding IAM role management since it might be handled elsewhere.
- **Test Integration:** The `Makefile` includes a `make test` command to run tests for all functions in the `functions` directory.

[aws_account]: https://aws.amazon.com/
[golang]: https://go.dev/doc/install
[aws_cli]: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#:r2b:-trigger
[aws_sam]: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html#:r2a:

[see_commands]: ./images/see_commands.png
[delete_commands]: ./how-to-delete.md
[serverless_framework]: https://www.serverless.com/blog/framework-example-golang-lambda-support